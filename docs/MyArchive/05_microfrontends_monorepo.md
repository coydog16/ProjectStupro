# マイクロフロントエンド + モノレポ型アーキテクチャ

## 基本概念

マイクロフロントエンドアーキテクチャは、フロントエンドアプリケーションを独立して開発・デプロイ可能な小さな単位に分割するパターンです。バックエンドはモジュラーモノリスとして保ちつつ、フロントエンドはより柔軟な分割を実現します。モノレポ（単一リポジトリ）で管理することで、共通部分の共有と独立性のバランスを取ります。

## ディレクトリ構造

### プロジェクト全体（モノレポ）

```
/                          # プロジェクトルート
├── package.json           # ワークスペースを定義したルートpackage.json
├── docker-compose.yml     # 開発環境設定
├── README.md              # プロジェクト説明
│
├── packages/              # 共有パッケージ
│   ├── ui-components/     # 共有UIコンポーネントライブラリ
│   │   ├── package.json
│   │   ├── src/
│   │   └── ...
│   │
│   ├── api-client/        # API通信用共通ライブラリ
│   │   ├── package.json
│   │   ├── src/
│   │   └── ...
│   │
│   ├── config/            # 共通設定
│   │   ├── package.json
│   │   ├── eslint-config.js
│   │   ├── tailwind-config.js
│   │   └── ...
│   │
│   └── utils/             # 共通ユーティリティ
│       ├── package.json
│       ├── src/
│       └── ...
│
├── apps/                  # アプリケーション
│   ├── main-shell/        # メインシェルアプリ（統合レイヤー）
│   │   ├── package.json
│   │   ├── index.html
│   │   ├── src/
│   │   │   ├── main.tsx
│   │   │   ├── App.tsx
│   │   │   ├── MicroFrontendLoader.tsx # MFEローダー
│   │   │   └── ...
│   │   └── ...
│   │
│   ├── auth-app/          # 認証マイクロフロントエンド
│   │   ├── package.json
│   │   ├── src/
│   │   │   ├── main.tsx   # スタンドアロン用エントリー
│   │   │   ├── remote.tsx # リモート用エントリー
│   │   │   └── ...
│   │   └── ...
│   │
│   ├── feed-app/          # フィード（投稿）マイクロフロントエンド
│   │   ├── package.json
│   │   ├── src/
│   │   └── ...
│   │
│   ├── profile-app/       # プロフィールマイクロフロントエンド
│   │   ├── package.json
│   │   ├── src/
│   │   └── ...
│   │
│   └── articles-app/      # 技術記事マイクロフロントエンド
│       ├── package.json
│       ├── src/
│       └── ...
│
└── backend/               # バックエンド（モジュラーモノリス）
    ├── app.py             # エントリーポイント
    ├── requirements.txt   # 依存パッケージ
    └── app/
        ├── app.py         # Flaskアプリ設定
        ├── config/        # 環境別設定
        │
        ├── core/          # コア機能
        │   ├── __init__.py
        │   ├── database.py
        │   └── ...
        │
        ├── modules/       # 機能モジュール
        │   ├── __init__.py
        │   ├── auth/      # 認証モジュール
        │   ├── posts/     # 投稿モジュール
        │   ├── users/     # ユーザーモジュール
        │   └── articles/  # 技術記事モジュール
        │
        └── api/           # API統合レイヤー
            ├── __init__.py
            ├── v1.py
            └── ...
```

### マイクロフロントエンド（例：feed-app）

```
apps/feed-app/
  ├── package.json         # 依存パッケージ管理
  ├── vite.config.ts       # ビルド設定（Module Federation対応）
  ├── index.html
  └── src/
      ├── main.tsx        # スタンドアロンモード用エントリーポイント
      ├── remote.tsx      # リモートモード用エントリーポイント
      ├── bootstrap.tsx   # 共通初期化処理
      │
      ├── components/     # コンポーネント
      │   ├── PostCard.tsx
      │   ├── PostList.tsx
      │   ├── CreatePostForm.tsx
      │   └── ...
      │
      ├── pages/          # ページ
      │   ├── FeedPage.tsx
      │   ├── PostDetailPage.tsx
      │   └── ...
      │
      ├── hooks/          # カスタムフック
      │   ├── usePosts.ts
      │   └── ...
      │
      ├── services/       # サービス
      │   ├── posts.ts    # 投稿関連API呼び出し
      │   └── ...
      │
      └── typings/        # 型定義
          └── index.ts
```

## 統合方法

マイクロフロントエンドの統合には主に以下の方法を使用します：

1. **Module Federation (Webpack/Vite)**: 各アプリが動的にモジュールをロード
2. **Web Components**: カスタム要素として各アプリを実装
3. **iFrames**: 完全に分離された環境で実行

このアーキテクチャ例ではModule Federationを採用しています。

## メリット

1. **独立した開発とデプロイ**: 各チームが独立してフロントエンドの一部を開発・デプロイ可能
2. **テクノロジーの多様性**: 必要に応じて異なるフレームワークやバージョンを使用可能
3. **スケーラビリティ**: チームと機能が増えても開発効率が低下しにくい
4. **モノレポによる開発体験**: 共通コードの共有と一貫性の維持が容易
5. **段階的移行**: 既存アプリから段階的に移行可能

## デメリット

1. **複雑性の増加**: ビルド設定やアプリ間通信などの複雑さ
2. **パフォーマンス考慮**: 不適切な実装は初期ロード時のパフォーマンスに影響
3. **統合テストの難しさ**: 複数アプリ間の統合テストが複雑になりうる
4. **一貫性の維持**: UIやUXの一貫性を保つための追加努力が必要

## 適した状況

- 複数チームが同時に開発する大規模フロントエンドアプリケーション
- 段階的に実装や改善を行いたいレガシーアプリケーション
- 機能ごとに異なる更新頻度や要件がある場合
- 将来的に機能を追加していくことが予想される場合

## バックエンド連携

バックエンドはモジュラーモノリスとして構築し、各マイクロフロントエンドに対応するAPIエンドポイントを提供します。APIはバックエンドモジュールの境界に合わせて設計し、各マイクロフロントエンドはそれに対応するバックエンドモジュールと通信します。
